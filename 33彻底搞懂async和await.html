<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // 参考文档
        // http://www.ruanyifeng.com/blog/2015/05/async.html

        // 彻底搞懂 async await 
        async function doSomething(num){
            if(num>10){
                return num;
            }else{
                Promise.reject('传入数字太小')
            }
        }

        async function getNum(){
            try{
                const num=await doSomething(11);
                console.log(num)
            }catch(e){
                console.log(e);
            }
        }
        getNum();

        // 案例二
        async function uploadFile(){
            //const result=await handleUploadHttp();
             //console.log(result);
            handleUploadHttp().then(res=>{
                console.log(res)
            })
           
            console.log('获取文件')
        }

        async function handleUploadHttp(){
            setTimeout(function(){
                console.log('我是一个延迟函数')
            },1000)
            console.log('我上传了文件');
            return 'txt.jpg'
        }
        uploadFile();

        async function timeout(ms) {
        return new Promise((resolve) => {
            setTimeout(resolve, ms);
        });
}

async function asyncPrint(value, ms) {
  await timeout(ms);
  console.log(value)
}

asyncPrint('hello world', 5000);


var dataVo={
    post(doc){
        return new Promise((resolve,reject)=>{
           
            setTimeout(function(){
                if(doc){
                    resolve(doc)
                }else{
                    reject(doc);
                }
               
            },1000)
        })
    }
}
async function dbFunc(db){
    let docs=[{name:'1'},{name:'2'},{name:'3'}]
    let promises=docs.map((doc)=>dataVo.post(doc));
    let results=await Promise.all(promises);
    console.log('结果:',results)
}

dbFunc();


// 多个请求并发执行
// 如果确实希望多个请求并发执行，可以使用 Promise.all 方法。


 function post(obj){
     return new Promise((resolve,reject)=>{
         setTimeout(function(){
             resolve(obj)
         },1000)
     })
 }

    async function sayPost(){
        const res=await post({name:'王菲'});
        console.log(res)
        console.log('测试')
    }
    sayPost();
    async function getData(){
        const arr=[post({name:'王菲'}),post({name:"松江"},post(null))]
        try{
            const result=await Promise.all(arr);
            console.log(result);
        }catch(e){
            console.log(e);
        }
    }

    getData();
    

    </script>

    <script>
        // 实例
        function print(delay,message){
            return new Promise((resolve,reject)=>{
                setTimeout(function(){
                    resolve(message)
                },delay);
            })
        }
        // 操作
        async function printAll(){
            const a=await print(1000,'a');
            const b=await print(1000,'b');
            const c=await print(1000,'c');
            console.log(a,b,c);
        }
        printAll();
    </script>
</body>
</html>