<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 题目地址 https://blog.csdn.net/good_father/article/details/108392806
      // 测试的时候一题一题测，不然题目中间执行过程会混在一起

      // 题目1
      // console.log('题目一开始执行')
      // console.log('1')
      // 	setTimeout(function () {
      // 	    console.log('2')
      // 	    setTimeout(function () {
      // 	        console.log('3')
      // 	    },0)
      // 	    new Promise(function (resolve) {
      // 	        console.log('4')
      // 	        for (let i = 0; i < 666; i++) {
      // 	            i == 5 && resolve()
      // 	        }
      // 	    }).then(function () {
      // 	        console.log('5')
      // 	    })
      // 	}, 0)
      // 	console.log('6')
      // 	new Promise(function (resolve) {
      // 	    console.log('7')
      // 	    for (let i = 0; i < 666; i++) {
      // 	        i == 5 && resolve()
      // 	    }
      // 	}).then(function () {
      // 	    console.log('8')
      // 	})
      //     console.log('题目1打印结果','1,6,7,8,2,4,5,3')
    </script>
    <script>
      // 题目2

      // setTimeout(() => {
      // 		console.log(4);
      // 	}, 0);

      // 	new Promise(resolve => {
      // 		console.log(1);
      // 		for (let i = 0; i < 10000; i++) {
      // 			i == 9999 && resolve();
      // 		}
      // 		console.log(2)
      // 	}).then(() => {
      // 		console.log(5)
      // 	})

      // 	console.log(3)
      //     console.log('打印结果','1,2,3,5,4')
    </script>

    <script>
      // 题目三
      // setTimeout(function(){

      // 			console.log('1')

      // 			});

      // 			new  Promise(function(resolve){
      // 			  console.log('2');
      // 			  resolve();
      // 			}).then(function(){
      // 			console.log('3')
      // 			});

      // 			console.log('4');

      //             console.log('打印结果','2,4,3,1')
    </script>
    <script>
      // 题目四
      // setTimeout(() => {
      // 		Promise.resolve().then(() => {
      // 			console.log('1')
      // 		})
      // 	},0);

      // 	Promise.resolve().then(() => {
      // 		setTimeout(() => {
      // 			console.log('2')
      // 		},0)
      // 	});

      // 	console.log('3')

      //     console.log('打印结果','3,')
    </script>

    <script>
      // console.log(1);//
      // document.addEventListener("14", function () {
      //   console.log(14);//
      // });
      // new Promise(function (resolve) {
      //   resolve();
      //   console.log(2);//
      //   setTimeout(function () {
      //     console.log(3);//
      //   }, 0);
      //   Promise.resolve().then(function () {
      //     console.log(4);//
      //     setTimeout(function () {
      //       console.log(5);
      //     }, 0);
      //     setTimeout(function () {
      //       (async function () {
      //         console.log(6);
      //         return function () {
      //           console.log(7);
      //         };
      //       })().then(function (fn) {
      //         console.log(8);
      //         fn();
      //       });
      //     }, 0);
      //   });
      //   new Promise(function (resolve) {
      //     console.log(9);//
      //     resolve();
      //   }).then(function () {
      //     new Promise(function (resolve, reject) {
      //       console.log(10);
      //       reject();
      //     }).then(function () {
      //         setTimeout(function () {
      //           console.log(11);
      //         }, 0);
      //         console.log(12);
      //       }).catch(function () {
      //         console.log(13);
      //         var evt = new Event("14");
      //         document.dispatchEvent(evt);
      //       });
      //   });
      // });
      // setTimeout(function () {
      //   console.log(15);
      //   Promise.resolve().then(function () {
      //     console.log(16);
      //   });
      // }, 0);

      //   console.log('打印结果','1,2,9,4,10,13,14,3,15,16,5,6,8,7')
    </script>
    <script>
      // new Promise((resolve,reject)=>{
      //   console.log('1')
      //   setTimeout(function(){
      //     console.log('2')
      //   },1000)
      //   setTimeout(function(){
      //     console.log(6);
      //   },200)
      //   console.log('3');
      //   resolve('4')
      // }).then(res=>{
      //   console.log(res);
      //   setTimeout(function(){
      //     console.log('5');
      //   },200)
      // })

      // console.log('打印结果','1,3,4,6,2,5')
    </script>

    <script>
      function testP3() {
        Promise.resolve(5)
          .then((res) => {
            console.log("mm");
            Promise.resolve()
              .then(() => {
                console.log("xx");
              })
              .then(() => {
                console.log("yy");
              });
            //Promise.resolve(3);
            return 10;
          })
          .then((res) => {
            console.log("nn");
          });
      }
      testP3();
      // console.log("打印结果", "mm xx nn yy");
    </script>

    <script>
      // 一文弄懂promise链式调用机制
      function testP1() {
        new Promise((resolve, reject) => {
          console.log("promise");
          resolve();
        })
          .then(() => {
            // 执行.then的时候生成一个promise是给最后一个.then的
            console.log("then1");
            new Promise((resolve, reject) => {
              console.log("then1promise");
              resolve();
            })
              .then(() => {
                // 执行这个.then的时候，生成的promise是下面一个then的
                console.log("then1then1");
                new Promise((resolve, reject) => {
                  resolve();
                }).then((res) => {
                  console.log("then3");
                });
              })
              .then(() => {
                console.log("then1then2");
              });
          })
          .then(() => {
            // 这个
            console.log("then2");
          });

        console.log(
          "打印结果",
          "promise then1 then1promise then1then1 then2   then1then2"
        );
      }
      // testP1();
      // 测试2
      function testP2() {
        const p = new Promise((resolve, reject) => {
          console.log("开始promise");
          setTimeout(resolve, 1000);
        });

        p.then((res) => {
          console.log(res);
          console.log("第一个then");
          new Promise((resolve, reject) => {
            console.log("我是promise");
            //resolve();
          }).then((res) => {
            console.log("测试");
          });
        })
          .then((res) => [console.log("第二个then")])
          .then((res) => {
            console.log("第三个then");
          });
      }

      function testP4() {
        let p = new Promise((resolve, reject) => {
          setTimeout(resolve, 1000);
          // resolve();
        });
        p.then(() => {
          console.log("log: 外部第一个then");
        });
        p.then(() => {
          console.log("log: 外部第二个then");
        });
        p.then(() => {
          console.log("log: 外部第三个then");
        });
      }

      //testP2();
      //testP4();
      Promise.resolve(5)
        .then((res) => {
          return 5;
        })
        .then((res) => {
          return Promise.resolve(5);
        })
        .then((res) => {
          console.log(res);
        });
    </script>
  </body>
</html>
